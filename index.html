<!-- DO NOT BE EVIL!!! -->
<!DOCTYPE html>
<html class="hola-html-reset hola-var" lang="zh-CN" style="--hola-primary-color: #3498db;">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>杭电助手</title>
    <link rel="stylesheet" href="/css/holakit.css">
    <style>
      .align-right {
        float: right;
        text-align: right;
      }
      .qr {
        float: center;
        padding-left: 20%;
        padding-right: 20%;
      }
      .hola-card {
        border-radius: 3px;
      }
      .hola-navbar {
        height: 60px;
      }
      .desc-line {
        font-size: .8em;
      }
      .hidden {
        display: none;
      }
      .fake-nav {
        background-color: #3498db !important;
        height: 48px;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1030;
        font-size: 1.2em;
      }
    </style>
    <script src="/js/easy.qrcode.min.js"></script>
  </head>
  <body class="hola-body-typography hola-grey-bg">
    
    <header class="hola-navbar hola-navbar-transparent hola-navbar-darkbg">
      <div class="hola-container">
        <nav class="hola-navbar-main">
          <a href="#" onclick="promptCookie();parseParams();" class="hola-navbar-brand">
            <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24">
              <path d="M0 0h24v24H0z" fill="none"/>
              <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" fill="hsla(0,0%,100%,.6)"/>
            </svg>
          </a>
        </nav>
      </div>
    </header>

    <header id="_fakenav" class="hola-navbar hola-navbar-white fake-nav hola-navbar-darkbg hidden">
      <div class="hola-container">
        <nav class="hola-navbar-main" style="line-height: 3rem;">
          <a href="#" onclick="promptCookie();parseParams();" style="padding-right: 0; vertical-align: middle;">
            <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24">
              <path d="M0 0h24v24H0z" fill="none"/>
              <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" fill="hsla(0,0%,100%,.6)"/>
            </svg>
          </a>
          <span style="color:white;">
            <b>表单</b>
          </span>
        </nav>
      </div>
    </header>
  
    <div class="hola-hero hola-hero-dark-bg" style="min-height: 90px; max-height: 120px">
      <div class="hola-container">
        <h2 id="_canary" style="padding-left: 5%; padding-top: 20px;">表单</h2>
      </div>
    </div>

    <div class="hola-container" style="margin-top: -40px;">
      <div class="hola-columns hola-card-stack">
        <div class="hola-columns-item">
          <div class="hola-card">
            <h2 class="title" style="text-align: center; color: rgb(52, 152, 219);">学生离校请假</h2>
            <p><b><span id="status">已上报</span></b></p>
          </div>
        </div>

        <div class="hola-columns-item">
          <div class="hola-card">
            <p></p>
            <div id="qrcode" style="text-align: center"></div>
            <p></p>
            <p style="text-align: center;"><b>当前时间: <span id="date"></span> <span id="time"></span> <span id="timezone">GMT+8000 (CST)</span></b></p>
          </div>
        </div>

        <div class="hola-columns-item">
          <div class="hola-card hola-card-list">
            <div class="hola-card-list-item">
              <b>姓名</b>
              <span id="name" class="align-right">蛤蛤</span>
            </div>
            <div class="hola-card-list-item">
              <b>学号</b>
              <span id="id" class="align-right">1926</span>
            </div>
            <div class="hola-card-list-item">
              <b>学院</b>
              <span id="school" class="align-right">膜法学院</span>
            </div>
            <div class="hola-card-list-item">
              <b>班级</b>
              <span id="class" class="align-right">0817</span>
            </div>
            <div class="hola-card-list-item">
              <b>辅导员</b>
              <span id="boss" class="align-right">奈伊吾</span>
            </div>
          </div>
        </div>

        <div class="hola-columns-item">
          <div class="hola-card hola-card-list">
            <div class="hola-card-list-item">
              <p style="text-align: center"><b>请假内容</b></p>
            </div>            
            <div class="hola-card-list-item">
              <p>请假类型（必填）</p>
              <select id="leave-type" value="0" style="width:100%;height:24px" disabled="disabled">
                <option value="0">&lt; 请选择 &gt;</option>
                <option value="1">2小时以内</option>
                <option value="2">2小时以上(当天门禁前回校)</option>
                <option value="3">单位实习(按周请假)</option>
                <option value="4">其他特殊情况</option>
              </select>
            </div>
            <div class="hola-card-list-item">
              <p style="margin-bottom: 0">请假开始日期（必填）</p>
              <p class="desc-line">离开学校的日期</p>
              <input id="date-from" type="date" style="width:100%;height:24px" disabled="disabled" />
            </div>
            <div class="hola-card-list-item">
              <p style="margin-bottom: 0">请假结束日期（必填）</p>
              <p class="desc-line">返回学校的日期</p>
              <input id="date-to" type="date" style="width:100%;height:24px" disabled="disabled" />
            </div>
            <div class="hola-card-list-item">
              <p style="margin-bottom: 0">请假原因（必填）</p>
              <p class="desc-line">请说明请假的原因，如果有具体的离校时间，也可以附上</p>
              <textarea id="excuse" style="width:100%;height:24px" disabled="disabled" placeholder=""></textarea>
            </div>
            <div id="_item-attach" class="hola-card-list-item hidden">
              <p style="margin-bottom: 0">附件</p>
              <p class="desc-line">如果有相关材料可在此补充</p>
              <img id="attach" style="width:100%" src="" />
            </div>
            <div class="hola-card-list-item">
              <p>请假期间是否离开浙江（必填）</p>
              <select id="leave-zj" value="0" style="width:100%;height:24px" disabled="disabled">
                <option value="0">&lt; 请选择 &gt;</option>
                <option value="1">否</option>
                <option value="2">是</option>
              </select>
            </div>
            <div class="hola-card-list-item">
              <p style="margin-bottom: 0;">签名（必填）</p>
              <p class="desc-line">本人郑重承诺:我承诺上述内容真实有效，离校期间注意自身安全，如有身体不适及时向学校报告</p>
              <img id="sign" style="width:100%;" src="" />
              <p class="desc-line">请点击「确认」上传签名后再提交表单。</p>
            </div>
          </div>
        </div>

        <div class="hola-columns-item">
          <div class="hola-card hola-card-list">
            <div class="hola-card-list-item">
              <b>1审意见</b>
              <span id="comment1" class="align-right">无意见或备注</span>
            </div>
            <div id="_item-comment2" class="hola-card-list-item hidden">
              <b>2审意见</b>
              <span id="comment2" class="align-right">无意见或备注</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <script>
      function setCookie(cname, cvalue) {
        cvalue = escape(cvalue);
        var d = new Date(), exdays = 365;
        d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
        var expires = "expires="+d.toUTCString();
        document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
      }

      function getCookie(cname) {
        var name = cname + "=";
        var ca = document.cookie.split(';');
        for(var i = 0; i < ca.length; i++) {
          var c = ca[i];
          while (c.charAt(0) == ' ') {
            c = c.substring(1);
          }
          if (c.indexOf(name) == 0) {
            return unescape(c.substring(name.length, c.length));
          }
        }
        return null;
      }

      function promptCookie() {
        key = prompt("请输入 id", "");
        if (!key)
          return;
        value = prompt("请输入 " + key + " 的内容", "");
        setCookie(key, value);
      }

      function updateDate() {
        var date = new Date();
        document.getElementById("date").innerText = (date.getMonth() + 1) + "月" + date.getDate() + "日 ";
      }
      
      function updateTime() {
        var date = new Date();
        var hour = date.getHours();
        var minute = date.getMinutes();
        var second = date.getSeconds();
        var ampm = "AM";
        if (hour > 12) {
          hour -= 12;
          ampm = "PM";
        }
        
        if (hour < 10) {
          hour = "0" + hour;
        }
        if (minute < 10) {
          minute = "0" + minute;
        }
        if (second < 10) {
          second = "0" + second;
        }

        document.getElementById("time").innerText = hour + ":" + minute + ":" + second + " " + ampm;
      }

      function generateUUID() {
        var d = new Date().getTime();
        var d2 = (performance && performance.now && (performance.now() * 1000)) || 0;
        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
            var r = Math.random() * 16;
            if (d > 0) {
                r = (d + r) % 16 | 0;
                d = Math.floor(d / 16);
            } else {
                r = (d2 + r) % 16 | 0;
                d2 = Math.floor(d2/16);
            }
            return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);
        });
      }

      function genQrCode(uuid) {
        var options = {
          version: 0,
          text: 'https://qr.hduhelp.com/pass?id=' + (uuid ? uuid : generateUUID()),
          correctLevel : QRCode.CorrectLevel.M,
          width: 192,
          height: 192,
          colorDark : '#3498db',
          colorLight : '#ffffff',
          logo: '/img/icon.png', 
          logoWidth: 64,
          logoHeight: 64, 
          logoBackgroundTransparent: true
        };
        new QRCode(document.getElementById("qrcode"), options);
      }

      function updateInfo(cur, data) {
        if (cur.tagName === "SPAN") {
          cur.innerText = data.toString();
        } else if (cur.tagName === "IMG") {
          cur.src = data.toString();
        } else {
          cur.value = data.toString();
        }
      }

      function parseParams() {
        // Check cookie
        var allIds = document.querySelectorAll('*[id]');
        for (var e of allIds) {
          if (!e.id || e.id[0] == '_')
            continue;
          var data = getCookie(e.id);
          if (data !== null) {
            updateInfo(e, data);
          }
        }

        // Check params
        var searchParams = new URLSearchParams(window.location.search);
        for (var p of searchParams) {
          if (p[0][0] == '_')
            continue;
          var cur = document.getElementById(p[0]);
          if (!cur) {
            continue;
          }

          if (document.getElementById("item-" + cur.id)) {
            document.getElementById("item-" + cur.id).classList.remove("hidden");
          }

          if (!p[1]) {
            continue;
          }
          
          setCookie(p[0], p[1]);
          updateInfo(cur, p[1]);
        }
      }

      function isElementInView(elem) {
        var bounding = elem.getBoundingClientRect();
        return (
            bounding.top >= 0 &&
            bounding.left >= 0 &&
            bounding.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
            bounding.right <= (window.innerWidth || document.documentElement.clientWidth)
        );
      }

      updateDate();
      setInterval(updateTime, 500);
      genQrCode();
      parseParams();

      window.onscroll = function() {
        var ret = isElementInView(document.getElementById("_canary"));
        if (ret) {
          document.getElementById("_fakenav").classList.add("hidden");
        } else {
          document.getElementById("_fakenav").classList.remove("hidden");
        }
      }
    </script>
  </body>
</html>
  
